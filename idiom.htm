<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸­æ–‡æˆèªå­¸ç¿’å°å¤©åœ° ğŸ§© (éŸ¿æ‡‰å¼è¨­è¨ˆ)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f0f9ff;
            overflow: hidden; /* Prevent confetti from causing scrollbars */
        }
        .card {
            background-color: white;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            position: relative;
            z-index: 10;
        }
        .btn {
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }
        .feedback-correct {
            color: #16a34a;
            background-color: #dcfce7;
            border-left: 5px solid #22c55e;
        }
        .feedback-incorrect {
            color: #dc2626;
            background-color: #fee2e2;
            border-left: 5px solid #ef4444;
        }
        #word-pool-container {
            position: relative;
            background-color: #f8fafc;
            border: 2px dashed #cbd5e1;
            border-radius: 12px;
            overflow: hidden;
            cursor: default;
            height: 160px; /* Mobile first height */
        }
        .answer-slot, .char-bubble {
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            user-select: none;
            /* Responsive sizes */
            width: 48px;
            height: 48px;
            font-size: 24px;
        }
        .char-bubble {
            position: absolute;
            background-color: white;
            border: 2px solid #93c5fd;
            color: #1e3a8a;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.2s;
        }
        .answer-slot {
             background-color: #f1f5f9;
            border: 2px solid #e2e8f0;
            font-weight: bold;
            color: #1e3a8a;
            transition: background-color 0.2s;
        }

        /* SM breakpoint and up */
        @media (min-width: 640px) {
            #word-pool-container {
                height: 200px;
            }
            .answer-slot, .char-bubble {
                width: 56px;
                height: 56px;
                font-size: 28px;
            }
        }

        .char-bubble:hover {
            background-color: #dbeafe;
            transform: scale(1.1);
        }
        /* This class is no longer needed as we use display: none */
        /*
        .char-bubble.selected {
            background-color: #fdba74;
            border-color: #f97316;
            color: #7c2d12;
            opacity: 0.5;
            pointer-events: none;
        }
        */
        #answer-slots-container {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .answer-slot.filled {
            cursor: pointer;
            background-color: #e0f2fe;
        }
        .answer-slot.filled:hover {
            background-color: #bae6fd;
        }

        #confetti-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
            z-index: 20;
        }
        .confetti-piece {
            position: absolute;
            width: 10px;
            height: 10px;
            opacity: 0;
            animation: confetti-fall 3s ease-out forwards;
        }

        @keyframes confetti-fall {
            0% { opacity: 1; transform: translate(var(--x), var(--y)) rotate(0deg) scale(1); }
            100% { opacity: 0; transform: translate(var(--x-end), var(--y-end)) rotate(720deg) scale(0.5); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
        .shake {
            animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-2 sm:p-4">

    <div id="confetti-container"></div>

    <div id="app" class="card w-full max-w-2xl p-4 sm:p-6 md:p-8 text-center">
        <h1 class="text-2xl sm:text-3xl md:text-4xl font-bold text-sky-800 mb-2">ä¸­æ–‡æˆèªå­¸ç¿’å°å¤©åœ° ğŸ§©</h1>
        <p class="text-gray-500 mb-6 text-sm sm:text-base">é»é¸æ¼‚æµ®çš„æ–‡å­—ï¼Œæ‹¼å‡ºæ­£ç¢ºçš„æˆèªï¼</p>

        <div class="absolute top-2 right-2 sm:top-4 sm:right-4 bg-sky-100 text-sky-700 font-semibold px-3 py-1 sm:px-4 sm:py-2 rounded-full text-xs sm:text-sm">
            <span id="score">åˆ†æ•¸: 0</span>
        </div>

        <div id="emoji-display" class="text-5xl sm:text-6xl md:text-7xl mb-6 p-4 bg-sky-50 rounded-lg select-none"></div>

        <div id="answer-slots-container">
            <div class="answer-slot"></div>
            <div class="answer-slot"></div>
            <div class="answer-slot"></div>
            <div class="answer-slot"></div>
        </div>
        
        <div id="hint-display" class="mt-4 mb-4 p-3 rounded-lg text-left text-sm sm:text-base hidden bg-amber-100 text-amber-800 border-l-4 border-amber-500"></div>

        <div id="word-pool-container" class="mb-4"></div>

        <div id="buttons-container" class="grid grid-cols-2 md:grid-cols-4 gap-2 sm:gap-4">
            <button id="hint-btn" class="btn w-full bg-yellow-500 hover:bg-yellow-600 text-white font-bold px-4 py-2 sm:px-6 sm:py-3 rounded-lg text-base">æç¤º</button>
            <button id="reveal-char-btn" class="btn w-full bg-teal-500 hover:bg-teal-600 text-white font-bold px-4 py-2 sm:px-6 sm:py-3 rounded-lg text-base">é¡¯ç¤ºä¸€å­—</button>
            <button id="clear-btn" class="btn w-full bg-orange-500 hover:bg-orange-600 text-white font-bold px-4 py-2 sm:px-6 sm:py-3 rounded-lg text-base">æ¸…é™¤</button>
            <button id="check-btn" class="btn w-full bg-sky-500 hover:bg-sky-600 text-white font-bold px-4 py-2 sm:px-6 sm:py-3 rounded-lg text-base">ç¢ºå®š</button>
        </div>
        <button id="next-btn" class="btn w-full mt-4 bg-gray-700 hover:bg-gray-800 text-white font-bold px-8 py-3 rounded-lg text-lg hidden">ä¸‹ä¸€é¡Œ â†’</button>
        
        <div id="feedback" class="mt-6 p-4 rounded-lg text-left text-sm sm:text-base hidden"></div>
    </div>

    <script>
        const idioms = [
            // åŸæœ‰çš„ 10 å€‹
            { idiom: "ç•«è›‡æ·»è¶³", emojis: "ğŸ¨ğŸâ•ğŸ¦¶", meaning: "æ¯”å–»å¤šæ­¤ä¸€èˆ‰ï¼Œä¸ä½†ç„¡ç›Šï¼Œåè€Œæœ‰å®³ã€‚", example: "é€™ç¯‡æ–‡ç« å·²ç¶“å¾ˆå®Œæ•´äº†ï¼Œå†åŠ é€™ä¸€æ®µç°¡ç›´æ˜¯ç•«è›‡æ·»è¶³ã€‚" },
            { idiom: "äº•åº•ä¹‹è›™", emojis: "ğŸ•³ï¸â¬‡ï¸ğŸ¸", meaning: "æ¯”å–»è¦‹è­˜æ·ºè–„ï¼Œçœ¼å…‰ç‹¹éš˜çš„äººã€‚", example: "æˆ‘å€‘è¦å¤šçœ‹ä¸–ç•Œï¼Œæ‰ä¸æœƒæˆç‚ºäº•åº•ä¹‹è›™ã€‚" },
            { idiom: "å°ç‰›å½ˆç´", emojis: "ğŸ‘‰ğŸ‚ğŸ¶ğŸ¹", meaning: "æ¯”å–»å°ä¸æ‡‚é“ç†çš„äººè¬›é“ç†ï¼Œæˆ–è¬›è©±ä¸çœ‹å°è±¡ã€‚", example: "è·Ÿä»–é€™ç¨®äººè¬›é“ç†ï¼Œç°¡ç›´æ˜¯å°ç‰›å½ˆç´ã€‚" },
            { idiom: "äº¡ç¾Šè£œç‰¢", emojis: "ğŸƒâ€â™‚ï¸ğŸ‘ğŸ”§ğŸ ", meaning: "æ¯”å–»å‡ºäº†å•é¡Œä»¥å¾Œæƒ³è¾¦æ³•è£œæ•‘ï¼Œå¯ä»¥é˜²æ­¢ç¹¼çºŒæå¤±ã€‚", example: "é›–ç„¶é€™æ¬¡è€ƒè©¦å¤±æ•—äº†ï¼Œä½†åªè¦ç¾åœ¨é–‹å§‹åŠªåŠ›ï¼Œäº¡ç¾Šè£œç‰¢ï¼Œé‚„ç‚ºæ™‚ä¸æ™šã€‚" },
            { idiom: "ç‹å‡è™å¨", emojis: "ğŸ¦ŠğŸ¤¥ğŸ…ğŸ’ª", meaning: "æ¯”å–»å€šä»—åˆ¥äººçš„å‹¢åŠ›ä¾†æ¬ºå£“äººã€‚", example: "ä»–åªæ˜¯è€é—†çš„å¸æ©Ÿï¼Œå»ç‹å‡è™å¨ï¼Œåˆ°è™•æŒ‡æ‰‹ç•«è…³ã€‚" },
            { idiom: "ä¸€ç®­é›™éµ°", emojis: "ğŸ¹ğŸ¯ğŸ¦…ğŸ¦…", meaning: "æ¯”å–»åšä¸€ä»¶äº‹æƒ…ï¼ŒåŒæ™‚é”åˆ°å…©å€‹ç›®çš„ã€‚", example: "é€™æ¬¡å‡ºå·®é †ä¾¿æ¢æœ›äº†è€æœ‹å‹ï¼ŒçœŸæ˜¯ä¸€ç®­é›™éµ°ã€‚" },
            { idiom: "èƒ¸æœ‰æˆç«¹", emojis: "ğŸ‘¨â€ğŸ¨â¤ï¸ğŸ‹", meaning: "æ¯”å–»äº‹å‰å·²æœ‰äº†å…¨é¢çš„è€ƒæ…®å’Œå®‰æ’ï¼Œå› æ­¤é¡¯å¾—å¾ˆæœ‰æŠŠæ¡ã€‚", example: "çœ‹ä»–é‚£èƒ¸æœ‰æˆç«¹çš„æ¨£å­ï¼Œé€™æ¬¡æ¯”è³½è‚¯å®šè´å®šäº†ã€‚" },
            { idiom: "å®ˆæ ªå¾…å…”", emojis: "ğŸŒ³ğŸ°ğŸ˜´", meaning: "æ¯”å–»ä¸çŸ¥è®Šé€šï¼Œæ­»å®ˆç‹¹éš˜çš„ç¶“é©—ï¼Œæˆ–æ¯”å–»å¦„æƒ³ä¸å‹è€Œç²ã€‚", example: "åªæƒ³é é‹æ°£æˆåŠŸï¼Œç„¡ç•°æ–¼å®ˆæ ªå¾…å…”ã€‚" },
            { idiom: "ç›²äººæ‘¸è±¡", emojis: "ğŸ‘¨â€ğŸ¦¯ğŸ˜â“", meaning: "æ¯”å–»çœ‹å•é¡Œç‰‡é¢ï¼Œä»¥åæ¦‚å…¨ã€‚", example: "æˆ‘å€‘åœ¨åˆ†æå•é¡Œæ™‚è¦å…¨é¢ï¼Œä¸èƒ½ç›²äººæ‘¸è±¡ã€‚" },
            { idiom: "æ¯å¼“è›‡å½±", emojis: "ğŸµğŸ¹ğŸğŸ‘¥", meaning: "æ¯”å–»å› ç–‘ç¥ç–‘é¬¼è€Œå¼•èµ·ææ‡¼ã€‚", example: "åˆ¥æ¯å¼“è›‡å½±äº†ï¼Œé‚£åªæ˜¯çª—å¤–çš„æ¨¹æåœ¨æ™ƒå‹•ã€‚" },
            // æ–°å¢çš„ 40 å€‹
            { idiom: "ç•«é¾é»ç›", emojis: "ğŸ¨ğŸ‰ğŸ‘ï¸âœ¨", meaning: "æ¯”å–»åœ¨é—œéµä¹‹è™•åŠ ä¸Šä¸€ç­†ï¼Œä½¿å…§å®¹æ›´åŠ ç”Ÿå‹•æœ‰åŠ›ã€‚", example: "é€™æ®µçµå°¾çœŸæ˜¯ç•«é¾é»ç›ï¼Œè®“æ•´ç¯‡æ–‡ç« çš„ä¸»é¡Œéƒ½æ˜‡è¯äº†ã€‚" },
            { idiom: "æ©è€³ç›œéˆ´", emojis: "ğŸ™‰ğŸ‘‚í›”ğŸ””", meaning: "æ¯”å–»è‡ªå·±æ¬ºé¨™è‡ªå·±ï¼Œè©¦åœ–éš±çæ˜é¡¯çš„äº‹å¯¦ã€‚", example: "æ˜æ˜æ˜¯ä»–æ‰“ç ´äº†èŠ±ç“¶ï¼Œå»å‡è£ä¸çŸ¥é“ï¼ŒçœŸæ˜¯æ©è€³ç›œéˆ´ã€‚" },
            { idiom: "è‡ªç›¸çŸ›ç›¾", emojis: "ğŸ—£ï¸ğŸ›¡ï¸âš”ï¸", meaning: "æ¯”å–»è¨€è¡Œå‰å¾Œä¸ä¸€è‡´æˆ–äº’ç›¸æŠµè§¸ã€‚", example: "ä½ å‰›æ‰èªªä¸å–œæ­¡ä»–ï¼Œç¾åœ¨åˆç´„ä»–å‡ºå»ï¼Œè±ˆä¸æ˜¯è‡ªç›¸çŸ›ç›¾ï¼Ÿ" },
            { idiom: "æ„šå…¬ç§»å±±", emojis: "ğŸ‘´â›°ï¸â›ï¸ğŸ’ª", meaning: "æ¯”å–»åªè¦æœ‰æ†å¿ƒï¼Œå …æŒä¸æ‡ˆï¼Œå°±èƒ½å®Œæˆè‰±é‰…çš„ä»»å‹™ã€‚", example: "å­¸å¥½å¤–èªéœ€è¦æ„šå…¬ç§»å±±çš„ç²¾ç¥ã€‚" },
            { idiom: "å¡ç¿å¤±é¦¬", emojis: "ğŸ‘´ğŸğŸ¤·â€â™‚ï¸ğŸ‰", meaning: "æ¯”å–»å£äº‹åœ¨ä¸€å®šæ¢ä»¶ä¸‹å¯ä»¥è®Šæˆå¥½äº‹ï¼Œå¥½äº‹ä¹Ÿå¯èƒ½è®Šæˆå£äº‹ã€‚", example: "ä»–éŒ¯éäº†ç­æ©Ÿï¼Œå»å› æ­¤èº²éä¸€å ´æ„å¤–ï¼ŒçœŸæ˜¯å¡ç¿å¤±é¦¬ï¼Œç„‰çŸ¥éç¦ã€‚" },
            { idiom: "æ‹”è‹—åŠ©é•·", emojis: "ğŸ‘¨â€ğŸŒ¾ğŸŒ±â¬†ï¸ğŸ˜«", meaning: "æ¯”å–»é•åäº‹ç‰©ç™¼å±•çš„å®¢è§€è¦å¾‹ï¼Œæ€¥æ–¼æ±‚æˆï¼Œåè€ŒæŠŠäº‹æƒ…å¼„ç³Ÿã€‚", example: "çµ¦å­©å­å ±å¤ªå¤šæ‰è—ç­ï¼Œæ˜¯æ‹”è‹—åŠ©é•·çš„è¡Œç‚ºã€‚" },
            { idiom: "åˆ»èˆŸæ±‚åŠ", emojis: "â›µï¸ğŸ”ªğŸ’§âš”ï¸", meaning: "æ¯”å–»è¾¦äº‹æ‹˜æ³¥ï¼Œä¸çŸ¥è®Šé€šã€‚", example: "æ™‚ä»£å·²ç¶“è®Šäº†ï¼Œä½ é‚„ç”¨è€æ–¹æ³•ï¼Œé€™ç„¡ç•°æ–¼åˆ»èˆŸæ±‚åŠã€‚" },
            { idiom: "æ°´ä¸­æ’ˆæœˆ", emojis: "ğŸ’§ğŸŒ•ğŸ¤²ğŸ’¨", meaning: "æ¯”å–»åšæ ¹æœ¬åšä¸åˆ°çš„äº‹æƒ…ï¼Œç™½è²»åŠ›æ°£ã€‚", example: "æƒ³ä¸åŠªåŠ›å°±æˆåŠŸï¼Œç°¡ç›´æ˜¯æ°´ä¸­æ’ˆæœˆã€‚" },
            { idiom: "é©šå¼“ä¹‹é³¥", emojis: "ğŸ¹ğŸ¦ğŸ˜±", meaning: "æ¯”å–»å—éé©šåš‡çš„äººï¼Œé‡åˆ°ä¸€é»å‹•éœå°±éå¸¸å®³æ€•ã€‚", example: "ä¸Šæ¬¡è¢«é¨™å¾Œï¼Œä»–æˆäº†é©šå¼“ä¹‹é³¥ï¼Œä¸å†è¼•æ˜“ç›¸ä¿¡ä»»ä½•äººã€‚" },
            { idiom: "æäººæ†‚å¤©", emojis: "ğŸ¤”ğŸ˜ŸğŸ’¥ğŸŒ", meaning: "æ¯”å–»ä¸å¿…è¦çš„æˆ–æ¯«ç„¡æ ¹æ“šçš„æ†‚æ…®ã€‚", example: "åˆ¥æ“”å¿ƒäº†ï¼Œä½ çš„é‚£äº›ç…©æƒ±éƒ½æ˜¯æäººæ†‚å¤©ã€‚" },
            { idiom: "ä¸€é³´é©šäºº", emojis: "ğŸ¦ğŸ¤«â¡ï¸ğŸ¶ğŸ¤¯", meaning: "æ¯”å–»å¹³æ™‚æ²’æœ‰çªå‡ºçš„è¡¨ç¾ï¼Œä¸€ä¸‹å­åšå‡ºé©šäººçš„æˆç¸¾ã€‚", example: "ä»–åœ¨é€™æ¬¡æ¯”è³½ä¸­ä¸€é³´é©šäººï¼Œå¥ªå¾—äº†å† è»ã€‚" },
            { idiom: "ä¹ç‰›ä¸€æ¯›", emojis: "ğŸ®ğŸ®...ğŸ¤", meaning: "æ¯”å–»æ¥µå¤§æ•¸é‡ä¸­çš„æ¥µå°éƒ¨åˆ†ï¼Œå¾®ä¸è¶³é“ã€‚", example: "é€™é»éŒ¢å°ä»–ä¾†èªªï¼Œåªæ˜¯ä¹ç‰›ä¸€æ¯›ã€‚" },
            { idiom: "æŒ‡é¹¿ç‚ºé¦¬", emojis: "ğŸ‘‰ğŸ¦ŒğŸ—£ï¸ğŸ", meaning: "æ¯”å–»æ•…æ„é¡›å€’é»‘ç™½ï¼Œæ··æ·†æ˜¯éã€‚", example: "ä»–ç«Ÿç„¶åœ¨æ³•åº­ä¸ŠæŒ‡é¹¿ç‚ºé¦¬ï¼ŒçœŸæ˜¯è†½å¤§å¦„ç‚ºã€‚" },
            { idiom: "ç‹¼ç‹½ç‚ºå¥¸", emojis: "ğŸºğŸ¤ğŸ˜ˆ", meaning: "æ¯”å–»å£äººäº’ç›¸å‹¾çµï¼Œä¸€èµ·åšå£äº‹ã€‚", example: "é€™å…©å€‹è²ªå®˜ç‹¼ç‹½ç‚ºå¥¸ï¼Œç§åäº†å¤§é‡å…¬æ¬¾ã€‚" },
            { idiom: "è‰æœ¨çš†å…µ", emojis: "ğŸŒ¿ğŸŒ³ğŸ’‚â€â™‚ï¸ğŸ’‚â€â™‚ï¸", meaning: "å½¢å®¹äººåœ¨æ¥µåº¦é©šææ™‚ï¼Œç–‘ç¥ç–‘é¬¼çš„å¿ƒç†ç‹€æ…‹ã€‚", example: "é€ƒçŠ¯èº²åœ¨å±±è£¡ï¼Œé¢¨å¹è‰å‹•éƒ½è®“ä»–è‰æœ¨çš†å…µã€‚" },
            { idiom: "é›é³´ç‹—ç›œ", emojis: "ğŸ“ğŸ—£ï¸ğŸ•â€ğŸ¦ºí›”", meaning: "æŒ‡å¾®ä¸è¶³é“çš„æŠ€èƒ½ï¼Œä¹Ÿæ³›æŒ‡å·å·æ‘¸æ‘¸çš„è¡Œç‚ºã€‚", example: "ä»–åªæœƒäº›é›é³´ç‹—ç›œçš„ä¼å€†ï¼Œä¸Šä¸äº†å¤§å ´é¢ã€‚" },
            { idiom: "é–€åº­è‹¥å¸‚", emojis: "ğŸšªğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ğŸ›’", meaning: "å½¢å®¹ä¾†çš„äººå¾ˆå¤šï¼Œéå¸¸ç†±é¬§ã€‚", example: "é€™å®¶æ–°é–‹çš„é¤å»³ï¼Œæ¯å¤©éƒ½é–€åº­è‹¥å¸‚ã€‚" },
            { idiom: "å¤œéƒè‡ªå¤§", emojis: "ğŸ¤´ğŸ—£ï¸ğŸŒğŸ¤", meaning: "æ¯”å–»å­¤é™‹å¯¡èè€Œåˆå¦„è‡ªå°Šå¤§ã€‚", example: "æˆ‘å€‘æ‡‰è©²è¬™è™›å­¸ç¿’ï¼Œä¸èƒ½åƒå¤œéƒè‡ªå¤§ä¸€æ¨£ã€‚" },
            { idiom: "æ¨‚ä¸æ€èœ€", emojis: "ğŸ˜„ğŸ‰ğŸ¤”ğŸ ", meaning: "æ¯”å–»åœ¨æ–°ç’°å¢ƒä¸­å¾—åˆ°æ¨‚è¶£ï¼Œä¸æƒ³å†å›åˆ°åŸä¾†çš„åœ°æ–¹ã€‚", example: "ä»–åœ¨åœ‹å¤–ç”Ÿæ´»å¾—å¾ˆé–‹å¿ƒï¼Œå·²ç¶“æ¨‚ä¸æ€èœ€äº†ã€‚" },
            { idiom: "ç´™ä¸Šè«‡å…µ", emojis: "ğŸ“œğŸ—£ï¸âš”ï¸", meaning: "æ¯”å–»ç©ºè«‡ç†è«–ï¼Œä¸èƒ½è§£æ±ºå¯¦éš›å•é¡Œã€‚", example: "è¨ˆç•«å†å¥½ï¼Œä¸å»åŸ·è¡Œä¹Ÿåªæ˜¯ç´™ä¸Šè«‡å…µã€‚" },
            { idiom: "å››é¢æ¥šæ­Œ", emojis: " à¤šà¤¾à¤°à¥‹à¤‚ à¤“à¤° à¤¸à¥‡ à¤¦à¥à¤¶à¥à¤®à¤¨ à¤¸à¥‡ à¤˜à¤¿à¤°à¤¾ à¤¹à¥à¤† ", meaning: "æ¯”å–»å››é¢å—æ•µï¼Œå­¤ç«‹ç„¡æ´çš„å›°å¢ƒã€‚", example: "å…¬å¸ç¶“ç‡Ÿä¸å–„ï¼Œå¦‚ä»Šå·²æ˜¯å››é¢æ¥šæ­Œï¼Œç€•è‡¨ç ´ç”¢ã€‚" },
            { idiom: "ç ´é‡œæ²‰èˆŸ", emojis: "ğŸ’¥ğŸ³ğŸš¢â¬‡ï¸", meaning: "æ¯”å–»ä¸‹å®šæ±ºå¿ƒï¼Œä¸ç•™é€€è·¯ï¼Œå¥®æˆ°åˆ°åº•ã€‚", example: "é€™æ¬¡æˆ‘å€‘å¿…é ˆæŠ±è‘—ç ´é‡œæ²‰èˆŸçš„æ±ºå¿ƒï¼Œæ‰èƒ½è´å¾—å‹åˆ©ã€‚" },
            { idiom: "è‡¥è–ªå˜—è†½", emojis: "ğŸ›ŒğŸªµğŸ˜‹ğŸ¤¢", meaning: "å½¢å®¹äººåˆ»è‹¦è‡ªå‹µï¼Œç™¼å¥®åœ–å¼·ã€‚", example: "ä»–ç¶“æ­·å¤±æ•—å¾Œï¼Œè‡¥è–ªå˜—è†½ï¼Œçµ‚æ–¼æ±å±±å†èµ·ã€‚" },
            { idiom: "èé›èµ·èˆ", emojis: "ğŸ“ğŸ¶ğŸ’ƒğŸ•º", meaning: "æ¯”å–»æœ‰å¿—ä¹‹å£«åŠæ™‚å¥®ç™¼ã€‚", example: "ç‚ºäº†ç†æƒ³ï¼Œä»–æ¯å¤©èé›èµ·èˆï¼Œå‹¤å¥®å­¸ç¿’ã€‚" },
            { idiom: "è³è‡‚æ“‹è»Š", emojis: "ğŸ¦—ğŸ’ªğŸš—", meaning: "æ¯”å–»ä¸è‡ªé‡åŠ›ï¼ŒåšåŠ›ä¸èƒ½åŠçš„äº‹æƒ…ã€‚", example: "ä»–ä¸€å€‹äººæƒ³å°æŠ—å¤§å…¬å¸ï¼Œç°¡ç›´æ˜¯è³è‡‚æ“‹è»Šã€‚" },
            { idiom: "å”‡äº¡é½’å¯’", emojis: "ğŸ‘„ GONE, ğŸ¦·ğŸ¥¶", meaning: "æ¯”å–»é—œä¿‚å¯†åˆ‡ï¼Œåˆ©å®³ç›¸é—œã€‚ä¸€æ–¹å—æï¼Œå¦ä¸€æ–¹ä¹Ÿå¿…ç„¶å—æã€‚", example: "é€™å…©å®¶å…¬å¸å”‡äº¡é½’å¯’ï¼Œå¿…é ˆåˆä½œæ‰èƒ½å…±åº¦é›£é—œã€‚" },
            { idiom: "é£²é´†æ­¢æ¸´", emojis: "ğŸ·â˜ ï¸ğŸ˜©", meaning: "æ¯”å–»ç”¨éŒ¯èª¤çš„æ–¹æ³•ä¾†è§£æ±ºçœ¼å‰çš„å›°é›£ï¼Œè€Œä¸é¡§å¾Œæœã€‚", example: "é å€Ÿé«˜åˆ©è²¸ä¾†å‘¨è½‰ï¼Œç„¡ç•°æ–¼é£²é´†æ­¢æ¸´ã€‚" },
            { idiom: "æœä¸‰æš®å››", emojis: "ğŸ’â˜€ï¸3ï¸âƒ£ğŸŒ™4ï¸âƒ£", meaning: "æ¯”å–»å¸¸å¸¸è®Šå¦ï¼Œåè¦†ç„¡å¸¸ã€‚", example: "ä»–é€™å€‹äººåšäº‹ç¸½æ˜¯æœä¸‰æš®å››ï¼Œè®“äººç„¡æ³•ä¿¡ä»»ã€‚" },
            { idiom: "æœ›æ¢…æ­¢æ¸´", emojis: "ğŸ‘€ğŸ‘ğŸ¤¤", meaning: "æ¯”å–»ç”¨ç©ºæƒ³ä¾†å®‰æ…°è‡ªå·±ã€‚", example: "çœ‹è‘—æ—…éŠé›œèªŒï¼Œå¹»æƒ³è‡ªå·±å»æ—…è¡Œï¼Œä¸éæ˜¯æœ›æ¢…æ­¢æ¸´ç½·äº†ã€‚" },
            { idiom: "ç†Ÿèƒ½ç”Ÿå·§", emojis: "ğŸ‘ŒğŸ”„ğŸ’¯", meaning: "å½¢å®¹ä»»ä½•æŠ€èƒ½ï¼Œåªè¦å¤šç·´ç¿’ï¼Œå°±èƒ½è®Šå¾—ç†Ÿç·´å·§å¦™ã€‚", example: "å½ˆé‹¼ç´æ²’æœ‰æ·å¾‘ï¼Œå”¯æœ‰ç†Ÿèƒ½ç”Ÿå·§ã€‚" },
            { idiom: "æ»´æ°´ç©¿çŸ³", emojis: "ğŸ’§â¡ï¸ğŸª¨", meaning: "æ¯”å–»åªè¦æœ‰æ†å¿ƒï¼ŒåŠ›é‡é›–å°ä¹Ÿèƒ½åšå‡ºå¤§äº‹ã€‚", example: "åªè¦å …æŒä¸‹å»ï¼Œæˆ‘ç›¸ä¿¡æ»´æ°´ç©¿çŸ³ï¼Œä¸€å®šèƒ½æˆåŠŸã€‚" },
            { idiom: "åŠé€”è€Œå»¢", emojis: "ğŸƒâ€â™‚ï¸â¡ï¸ğŸ›‘", meaning: "æ¯”å–»äº‹æƒ…åšåˆ°ä¸€åŠå°±åœæ­¢ï¼Œæ²’æœ‰å …æŒåˆ°åº•ã€‚", example: "åšäº‹è¦æœ‰å§‹æœ‰çµ‚ï¼Œä¸èƒ½åŠé€”è€Œå»¢ã€‚" },
            { idiom: "éµ¬ç¨‹è¬é‡Œ", emojis: "ğŸ¦…âœˆï¸ğŸŒ…", meaning: "æ¯”å–»å‰é€”é å¤§ï¼Œä¸å¯é™é‡ã€‚", example: "ç¥ç¦ç•¢æ¥­çš„å­¸é•·å€‘éµ¬ç¨‹è¬é‡Œï¼Œä¸€å¸†é¢¨é †ã€‚" },
            { idiom: "å¾—æ„å¿˜å½¢", emojis: "ğŸ˜„ğŸ†ğŸ¤ª", meaning: "å½¢å®¹äººå› é«˜èˆˆè€Œå¤±å»å¸¸æ…‹ã€‚", example: "ä»–åªæ˜¯å¾—äº†ä¸€é»å°çï¼Œå°±å¾—æ„å¿˜å½¢äº†ã€‚" },
            { idiom: "åƒéˆä¸€é«®", emojis: "ğŸ‹ï¸â€â™‚ï¸â¬‡ï¸ğŸ‘±â€â™€ï¸", meaning: "æ¯”å–»æƒ…æ³éå¸¸å±æ€¥ã€‚", example: "åœ¨åƒéˆä¸€é«®ä¹‹éš›ï¼Œæ¶ˆé˜²å“¡æ•‘å‡ºäº†è¢«å›°çš„å­©å­ã€‚" },
            { idiom: "åŒèˆŸå…±æ¿Ÿ", emojis: "ğŸ›¶ğŸ¤â›ˆï¸", meaning: "æ¯”å–»åœ¨å›°é›£æ™‚ï¼Œå¤§å®¶åŒå¿ƒå”åŠ›ï¼Œå…±æ¸¡é›£é—œã€‚", example: "é¢å°é€™æ¬¡å±æ©Ÿï¼Œå…¨é«”å“¡å·¥å¿…é ˆåŒèˆŸå…±æ¿Ÿã€‚" },
            { idiom: "æŒ‰åœ–ç´¢é©¥", emojis: "ğŸ—ºï¸ğŸ§ğŸ", meaning: "æ¯”å–»æŒ‰ç…§ç·šç´¢å°‹æ‰¾ï¼Œä¹Ÿæ¯”å–»è¾¦äº‹æ©Ÿæ¢°ã€æ­»æ¿ã€‚", example: "è­¦å¯Ÿæ ¹æ“šç·šç´¢æŒ‰åœ–ç´¢é©¥ï¼Œå¾ˆå¿«å°±æ‰¾åˆ°äº†å«Œç–‘çŠ¯ã€‚" },
            { idiom: "ä¸æ¥ä¸‹å•", emojis: "ğŸ¤”ğŸ‘¨â€ğŸ«â“", meaning: "ä¸ä»¥å‘åœ°ä½ã€å­¸å•æ¯”è‡ªå·±ä½çš„äººè«‹æ•™ç‚ºæ¥ã€‚", example: "ä»–é›–ç„¶æ˜¯å°ˆå®¶ï¼Œä½†ä»èƒ½ä¸æ¥ä¸‹å•ï¼Œè™›å¿ƒå­¸ç¿’ã€‚" },
            { idiom: "ä¸‰é¡§èŒ…å»¬", emojis: "ğŸ¤´â¡ï¸ğŸ›–x3", meaning: "æ¯”å–»çœŸå¿ƒèª æ„åœ°é‚€è«‹è³¢æ‰ã€‚", example: "ç‚ºäº†è«‹ä»–å‡ºå±±ï¼Œæ ¡é•·ä¸‰é¡§èŒ…å»¬ï¼Œèª æ„åè¶³ã€‚" },
            { idiom: "é‡‘ç‰å…¶å¤–", emojis: "ğŸ’°ğŸ’ê²‰, ğŸ¥€ ì†", meaning: "å½¢å®¹å¤–è¡¨è¯ç¾ï¼Œè€Œå®è´¨ä¸å¥½ã€‚", example: "é€™ç”¢å“åŒ…è£ç²¾ç¾ï¼Œå»æ˜¯é‡‘ç‰å…¶å¤–ï¼Œæ•—çµ®å…¶ä¸­ã€‚" }
        ];

        let currentIdiomIndex = -1;
        let score = 0;
        let usedIndices = new Set();
        let userAnswer = new Array(4).fill(null);
        let bubbles = [];
        let animationFrameId;
        let bubbleSize = 56; // Default size, will be updated dynamically

        const emojiDisplay = document.getElementById('emoji-display');
        const wordPoolContainer = document.getElementById('word-pool-container');
        const answerSlots = document.querySelectorAll('.answer-slot');
        const nextBtn = document.getElementById('next-btn');
        const checkBtn = document.getElementById('check-btn');
        const clearBtn = document.getElementById('clear-btn');
        const hintBtn = document.getElementById('hint-btn');
        const revealCharBtn = document.getElementById('reveal-char-btn');
        const feedback = document.getElementById('feedback');
        const scoreDisplay = document.getElementById('score');
        const hintDisplay = document.getElementById('hint-display');
        const buttonsContainer = document.getElementById('buttons-container');
        const confettiContainer = document.getElementById('confetti-container');

        const DISTRACTOR_CHARS = "çš„ä¸€æ˜¯åœ¨ä¸äº†æœ‰å’Œäººé€™ä¸­å¤§ç‚ºä¸Šå€‹åœ‹æˆ‘ä»¥è¦ä»–æ™‚ä¾†ç”¨å€‘ç”Ÿåˆ°ä½œåœ°äºå‡ºå°±åˆ†";
        const CONFETTI_COLORS = ['#ffeb3b', '#4caf50', '#2196f3', '#f44336', '#9c27b0'];

        function generateChars(correctIdiom) {
            const correctChars = correctIdiom.split('');
            let allChars = new Set(correctChars);
            while (allChars.size < 12) {
                const randomIndex = Math.floor(Math.random() * DISTRACTOR_CHARS.length);
                allChars.add(DISTRACTOR_CHARS[randomIndex]);
            }
            return Array.from(allChars).sort(() => Math.random() - 0.5);
        }
        
        function loadNewIdiom() {
            if (usedIndices.size === idioms.length) {
                alert("æ­å–œï¼æ‚¨å·²å®Œæˆæ‰€æœ‰æˆèªï¼å°‡é‡æ–°é–‹å§‹ã€‚");
                usedIndices.clear();
                score = 0;
                scoreDisplay.textContent = `åˆ†æ•¸: ${score}`;
            }
            
            do {
                currentIdiomIndex = Math.floor(Math.random() * idioms.length);
            } while (usedIndices.has(currentIdiomIndex));
            
            usedIndices.add(currentIdiomIndex);

            const idiomData = idioms[currentIdiomIndex];
            emojiDisplay.textContent = idiomData.emojis;

            resetUI();

            const chars = generateChars(idiomData.idiom);
            wordPoolContainer.innerHTML = '';
            bubbles = [];
            const containerRect = wordPoolContainer.getBoundingClientRect();

            chars.forEach(char => {
                const bubbleEl = document.createElement('div');
                bubbleEl.className = 'char-bubble';
                bubbleEl.textContent = char;
                bubbleEl.addEventListener('click', () => onCharClick(bubbleEl));
                wordPoolContainer.appendChild(bubbleEl);
                
                bubbles.push({
                    el: bubbleEl,
                    x: Math.random() * (containerRect.width - bubbleEl.offsetWidth),
                    y: Math.random() * (containerRect.height - bubbleEl.offsetHeight),
                    vx: (Math.random() - 0.5) * 1.5,
                    vy: (Math.random() - 0.5) * 1.5
                });
            });
            
            if (bubbles.length > 0) {
                bubbleSize = bubbles[0].el.offsetWidth;
            }

            startAnimation();
        }

        function onCharClick(bubbleEl) {
            if (bubbleEl.style.display === 'none') return;

            const firstEmptyIndex = userAnswer.indexOf(null);
            if (firstEmptyIndex === -1) return;
            
            const char = bubbleEl.textContent;
            userAnswer[firstEmptyIndex] = { char: char, el: bubbleEl };
            bubbleEl.style.display = 'none'; // Hide the bubble
            updateAnswerSlots();
        }

        function onSlotClick(slotIndex) {
            if (userAnswer[slotIndex]) {
                const removedItem = userAnswer[slotIndex];
                if (removedItem.el) {
                    removedItem.el.style.display = 'flex'; // Show the bubble again
                }
                userAnswer[slotIndex] = null;
                updateAnswerSlots();
            }
        }

        function updateAnswerSlots() {
            answerSlots.forEach((slot, index) => {
                const item = userAnswer[index];
                if (item) {
                    slot.textContent = item.char;
                    slot.classList.add('filled');
                } else {
                    slot.textContent = '';
                    slot.classList.remove('filled');
                }
                slot.classList.remove('shake');
            });
        }

        function resetUI() {
            userAnswer = new Array(4).fill(null);
            updateAnswerSlots();
            feedback.classList.add('hidden');
            hintDisplay.classList.add('hidden');
            nextBtn.classList.add('hidden');
            buttonsContainer.classList.remove('hidden');
            wordPoolContainer.style.pointerEvents = 'auto';
            revealCharBtn.disabled = false;
        }

        function clearAnswer() {
            userAnswer.forEach(item => {
                if (item && item.el) item.el.style.display = 'flex';
            });
            userAnswer = new Array(4).fill(null);
            updateAnswerSlots();
        }

        function showHint() {
            const idiomData = idioms[currentIdiomIndex];
            hintDisplay.textContent = `æç¤ºï¼š${idiomData.meaning}`;
            hintDisplay.classList.remove('hidden');
        }

        function revealOneCharacter() {
            const correctIdiom = idioms[currentIdiomIndex].idiom;
            const incorrectOrEmptyIndices = [];
            
            for (let i = 0; i < 4; i++) {
                if (!userAnswer[i] || userAnswer[i].char !== correctIdiom[i]) {
                    incorrectOrEmptyIndices.push(i);
                }
            }

            if (incorrectOrEmptyIndices.length === 0) return;

            const indexToFix = incorrectOrEmptyIndices[Math.floor(Math.random() * incorrectOrEmptyIndices.length)];
            const correctChar = correctIdiom[indexToFix];

            if (userAnswer[indexToFix]) {
                onSlotClick(indexToFix);
            }
            
            const misplacedIndex = userAnswer.findIndex(item => item && item.char === correctChar);
            if (misplacedIndex !== -1) {
                onSlotClick(misplacedIndex);
            }

            const correctBubbleEl = bubbles.find(b => b.el.style.display !== 'none' && b.el.textContent === correctChar)?.el;
            if (correctBubbleEl) {
                correctBubbleEl.style.display = 'none';
                userAnswer[indexToFix] = { char: correctChar, el: correctBubbleEl };
                updateAnswerSlots();
            }
            revealCharBtn.disabled = true;
        }

        function triggerConfetti() {
            const numConfetti = 50;
            for (let i = 0; i < numConfetti; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti-piece';
                confetti.style.backgroundColor = CONFETTI_COLORS[Math.floor(Math.random() * CONFETTI_COLORS.length)];
                
                const startX = window.innerWidth / 2;
                const startY = window.innerHeight / 2;
                const endX = startX + (Math.random() - 0.5) * window.innerWidth * 1.5;
                const endY = startY + Math.random() * window.innerHeight * 0.8;

                confetti.style.setProperty('--x', `${startX - 5}px`);
                confetti.style.setProperty('--y', `${startY - 5}px`);
                confetti.style.setProperty('--x-end', `${endX}px`);
                confetti.style.setProperty('--y-end', `${endY}px`);

                confettiContainer.appendChild(confetti);
                confetti.addEventListener('animationend', () => confetti.remove());
            }
        }

        function triggerShakeAnimation() {
            answerSlots.forEach(slot => {
                if (slot.classList.contains('filled')) {
                    slot.classList.add('shake');
                    slot.addEventListener('animationend', () => slot.classList.remove('shake'), { once: true });
                }
            });
        }

        function checkAnswer() {
            if (userAnswer.some(item => item === null)) {
                alert('è«‹å¡«æ»¿å››å€‹å­—ï¼');
                return;
            }
            
            stopAnimation();
            const submittedAnswer = userAnswer.map(item => item.char).join('');
            const correctIdiom = idioms[currentIdiomIndex];
            
            feedback.classList.remove('hidden');
            nextBtn.classList.remove('hidden');
            buttonsContainer.classList.add('hidden');
            wordPoolContainer.style.pointerEvents = 'none';

            if (submittedAnswer === correctIdiom.idiom) {
                feedback.innerHTML = `<h3 class="font-bold text-lg mb-2">ğŸ‰ ç­”å°äº†ï¼å°±æ˜¯ã€Œ${correctIdiom.idiom}ã€</h3><p class="mt-2"><strong>è§£é‡‹ï¼š</strong>${correctIdiom.meaning}</p><p class="mt-2"><strong>ä¾‹å­ï¼š</strong>${correctIdiom.example}</p>`;
                feedback.className = 'mt-6 p-4 rounded-lg text-left text-sm sm:text-base feedback-correct';
                score++;
                scoreDisplay.textContent = `åˆ†æ•¸: ${score}`;
                triggerConfetti();
            } else {
                feedback.innerHTML = `<h3 class="font-bold text-lg mb-2">ğŸ¤” å·®ä¸€é»é»ï¼</h3><p class="mt-2"><strong>æ­£ç¢ºç­”æ¡ˆæ˜¯ï¼š</strong>ã€Œ${correctIdiom.idiom}ã€</p><p class="mt-2"><strong>è§£é‡‹ï¼š</strong>${correctIdiom.meaning}</p><p class="mt-2"><strong>ä¾‹å­ï¼š</strong>${correctIdiom.example}</p>`;
                feedback.className = 'mt-6 p-4 rounded-lg text-left text-sm sm:text-base feedback-incorrect';
                triggerShakeAnimation();
            }
        }
        
        function animate() {
            if(!wordPoolContainer) return;
            const containerRect = wordPoolContainer.getBoundingClientRect();
            if(containerRect.width === 0) {
                 animationFrameId = requestAnimationFrame(animate);
                 return;
            }
            bubbles.forEach(b => {
                b.x += b.vx;
                b.y += b.vy;

                if (b.x <= 0 || b.x >= containerRect.width - bubbleSize) b.vx *= -1;
                if (b.y <= 0 || b.y >= containerRect.height - bubbleSize) b.vy *= -1;
                
                b.el.style.transform = `translate(${b.x}px, ${b.y}px)`;
            });
            animationFrameId = requestAnimationFrame(animate);
        }
        
        function startAnimation() {
            if (!animationFrameId) {
                animationFrameId = requestAnimationFrame(animate);
            }
        }
        
        function stopAnimation() {
            if (animationFrameId) {
                cancelAnimationFrame(animationFrameId);
                animationFrameId = null;
            }
        }

        nextBtn.addEventListener('click', loadNewIdiom);
        checkBtn.addEventListener('click', checkAnswer);
        clearBtn.addEventListener('click', clearAnswer);
        hintBtn.addEventListener('click', showHint);
        revealCharBtn.addEventListener('click', revealOneCharacter);
        answerSlots.forEach((slot, index) => {
            slot.addEventListener('click', () => onSlotClick(index));
        });

        loadNewIdiom();
    </script>

</body>
</html>


