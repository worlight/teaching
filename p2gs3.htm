<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äºŒå¹´ç´šå¸¸è­˜ç§‘ç¶œåˆè©•ä¼° (è©³ç´°å ±å‘Šç‰ˆ)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #fff7ed;
            touch-action: manipulation;
        }
        .option-btn {
            transition: all 0.2s;
        }
        .option-btn:active {
            transform: scale(0.98);
        }
        /* é¸ä¸­ç‹€æ…‹ */
        .selected-option {
            background-color: #ffedd5 !important; /* Orange-100 */
            border-color: #f97316 !important; /* Orange-500 */
            color: #9a3412 !important; /* Orange-800 */
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .fade-in {
            animation: fadeIn 0.4s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .report-card {
            max-height: 60vh;
            overflow-y: auto;
            scrollbar-width: thin;
        }
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: #f00;
            animation: fall linear forwards;
        }
        @keyframes fall {
            to { transform: translateY(100vh) rotate(720deg); }
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <div class="max-w-3xl w-full bg-white rounded-3xl shadow-xl overflow-hidden border-4 border-orange-200 relative" id="app-container">
        
        <!-- 1. æ­¡è¿ç•«é¢ -->
        <div id="start-screen" class="p-8 text-center space-y-6">
            <div class="text-6xl mb-4">ğŸ“ ğŸ“ ğŸ’¯</div>
            <h1 class="text-3xl font-bold text-orange-600 tracking-wide">å¸¸è­˜ç§‘ç¶œåˆè©•ä¼°<br>(æ¨¡æ“¬è€ƒè©¦æ¨¡å¼)</h1>
            
            <div class="bg-orange-50 p-6 rounded-xl text-left text-gray-700 space-y-3 shadow-inner">
                <h3 class="font-bold text-lg text-orange-800 border-b border-orange-200 pb-2 mb-2">è€ƒè©¦è¦å‰‡ï¼š</h3>
                <p>1. ç¸½å…±æœ‰ <strong>20 é¡Œ</strong>ã€‚</p>
                <p>2. ä½œç­”æ™‚<strong>ä¸æœƒ</strong>ç«‹å³é¡¯ç¤ºå°éŒ¯ã€‚</p>
                <p>3. å®Œæˆæ‰€æœ‰é¡Œç›®å¾Œï¼Œæœƒæ´¾ç™¼<strong>è©³ç´°æˆç¸¾å–®</strong>ã€‚</p>
                <p>4. è«‹ç´°å¿ƒé–±è®€é¡Œç›®ï¼Œé¸å‡ºæœ€åˆé©çš„ç­”æ¡ˆã€‚</p>
            </div>

            <div class="pt-2">
                <input type="text" id="student-name" placeholder="è«‹è¼¸å…¥ä½ çš„åå­—" class="w-full p-4 border-2 border-orange-200 rounded-xl text-xl focus:border-orange-500 focus:outline-none mb-4 text-center">
                <button onclick="startQuiz()" class="w-full bg-orange-500 hover:bg-orange-600 text-white font-bold py-4 px-8 rounded-xl text-xl shadow-md transition transform hover:-translate-y-1">
                    é–‹å§‹è€ƒè©¦ âœï¸
                </button>
            </div>
        </div>

        <!-- 2. æ¸¬é©—ç•«é¢ -->
        <div id="quiz-screen" class="hidden flex flex-col h-full" style="min-height: 600px;">
            <!-- é ‚éƒ¨è³‡è¨Š -->
            <div class="bg-orange-100 p-4 flex justify-between items-center shadow-sm z-10">
                <div class="flex items-center space-x-2">
                    <span class="font-bold text-orange-800 text-lg" id="display-name">åŒå­¸</span>
                </div>
                <div class="text-orange-900 font-bold text-lg">
                    ç¬¬ <span id="current-q-num" class="text-2xl">1</span> / <span id="total-q-num">20</span> é¡Œ
                </div>
            </div>
            <!-- é€²åº¦æ¢ -->
            <div class="w-full bg-gray-200 h-3">
                <div id="progress-bar" class="bg-green-500 h-3 transition-all duration-300" style="width: 0%"></div>
            </div>

            <!-- å•é¡Œå€åŸŸ -->
            <div class="p-6 flex-grow flex flex-col justify-between overflow-y-auto">
                <div id="question-container" class="fade-in space-y-6">
                    <!-- æ¨™ç±¤ -->
                    <span id="q-category" class="inline-block bg-yellow-100 text-yellow-800 text-sm px-3 py-1 rounded-full font-bold mb-2">é¡Œç›®é¡å‹</span>
                    
                    <!-- é¡Œç›® -->
                    <h2 id="q-text" class="text-2xl font-bold text-gray-800 leading-relaxed">
                        é¡Œç›®è¼‰å…¥ä¸­...
                    </h2>

                    <!-- é¸é … -->
                    <div id="options-grid" class="grid grid-cols-1 gap-4 mt-6">
                        <!-- JSç”Ÿæˆé¸é … -->
                    </div>
                </div>

                <!-- ä¸‹ä¸€é¡ŒæŒ‰éˆ• (å›ºå®šåœ¨åº•éƒ¨) -->
                <div class="mt-8 pt-4 border-t border-gray-100">
                    <button id="next-btn" onclick="confirmAndNext()" class="w-full bg-gray-300 text-white font-bold py-4 rounded-xl text-xl cursor-not-allowed transition" disabled>
                        è«‹å…ˆé¸æ“‡ç­”æ¡ˆ
                    </button>
                </div>
            </div>
        </div>

        <!-- 3. çµæœç•«é¢ (æˆç¸¾å–®) -->
        <div id="result-screen" class="hidden flex flex-col h-full max-h-screen">
            <div class="p-6 bg-orange-500 text-white text-center shadow-md shrink-0 z-10">
                <h2 class="text-3xl font-bold mb-2">è€ƒè©¦æˆç¸¾å–®</h2>
                <div class="flex justify-center items-end space-x-2">
                    <span class="text-6xl font-bold" id="final-score">0</span>
                    <span class="text-2xl opacity-80 pb-2">/ 100</span>
                </div>
                <p id="result-message" class="mt-2 text-orange-100 font-medium"></p>
            </div>

            <!-- è©³ç´°å ±å‘Šåˆ—è¡¨ (å¯æ²å‹•) -->
            <div class="flex-grow bg-gray-50 p-6 report-card" id="report-container">
                <!-- JSç”Ÿæˆå ±å‘Šå¡ç‰‡ -->
            </div>

            <div class="p-4 bg-white border-t border-gray-200 shrink-0 z-10">
                <button onclick="restartQuiz()" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-xl text-lg shadow-md transition">
                    å†æ¬¡æŒ‘æˆ° ğŸ”„
                </button>
            </div>
        </div>

    </div>

    <script>
        // æ“´å……è‡³ 20 é¡Œï¼Œæ¶µè“‹æ‰€æœ‰å–®å…ƒç´°ç¯€
        const questions = [
            // --- å–®å…ƒä¸€ï¼šæ—¥èˆ‡å¤œ ---
            {
                type: "mc", category: "é¸æ“‡é¡Œ", score: 5,
                text: "1. ğŸ¦‰ è²“é ­é·¹æœ‰ä¸€é›™ã€Œå¤§çœ¼ç›ã€ï¼Œé€™å°ç‰ æœ‰ä»€éº¼å¹«åŠ©ï¼Ÿ",
                options: ["ç‚ºäº†çœ‹èµ·ä¾†æ›´å¨çŒ›", "ç‚ºäº†åœ¨é»‘æš—ä¸­çœ‹æ¸…çµç‰©", "ç‚ºäº†åš‡èµ°å…¶ä»–å‹•ç‰©", "ç‚ºäº†åœ¨ç™½å¤©ç¡è¦º"],
                answer: 1,
                explanation: "è²“é ­é·¹æ˜¯å¤œè¡Œå‹•ç‰©ï¼Œå¤§çœ¼ç›èƒ½å¹«åŠ©ç‰ åœ¨å¾®å¼±å…‰ç·šä¸‹çœ‹è¦‹çµç‰©ã€‚"
            },
            {
                type: "tf", category: "æ˜¯éé¡Œ", score: 5,
                text: "2. ğŸŒ ç™½å¤©çš„æ™‚å€™ï¼Œæˆ‘å€‘é€šå¸¸çœ‹ä¸è¦‹æ˜Ÿæ˜Ÿï¼Œæ˜¯å› ç‚ºæ˜Ÿæ˜Ÿé€™æ™‚å€™éƒ½èº²èµ·ä¾†ç¡è¦ºäº†ã€‚",
                answer: false,
                explanation: "æ˜Ÿæ˜Ÿä¸€ç›´éƒ½åœ¨ï¼Œåªæ˜¯ç™½å¤©å¤ªé™½çš„å…‰å¤ªå¼·ï¼Œè“‹éäº†å¾®å¼±çš„æ˜Ÿå…‰ï¼Œæ‰€ä»¥æˆ‘å€‘çœ‹ä¸è¦‹ã€‚"
            },
            {
                type: "mc", category: "é¸æ“‡é¡Œ", score: 5,
                text: "3. ğŸ’¡ ä»¥ä¸‹å“ªä¸€ç¨®ç‡ˆå…‰åœ¨æ™šä¸Šæ˜¯ã€Œä¸å¿…è¦ã€çš„ï¼Œå±¬æ–¼æµªè²»èƒ½æºï¼Ÿ",
                options: ["è¡—é“ä¸Šçš„è·¯ç‡ˆ", "æ›¸æˆ¿è£¡é–±è®€æ™‚çš„æª¯ç‡ˆ", "æ²’æœ‰äººçš„æˆ¿é–“é–‹è‘—çš„å¤§ç‡ˆ", "æ±½è»Šçš„è»Šé ­ç‡ˆ"],
                answer: 2,
                explanation: "æ²’äººåœ¨æˆ¿é–“æ™‚æ‡‰è©²é—œç‡ˆï¼Œç¯€ç´„èƒ½æºã€‚"
            },
            {
                type: "checkbox", category: "å¤šé¸é¡Œ", score: 5,
                text: "4. ğŸ  ä»¥ä¸‹å“ªäº›æ´»å‹•é©åˆåœ¨ã€Œæ™šä¸Šã€é€²è¡Œï¼Ÿ(å¯å¤šé¸)",
                options: ["æ›¬å¤ªé™½", "ç¡è¦º", "è³æœˆ", "æ”¾é¢¨ç®"],
                correctIndices: [1, 2],
                explanation: "æ™šä¸Šæ²’æœ‰å¤ªé™½å’Œé¢¨åŠ›é€šå¸¸ä¸è¶³ï¼Œé©åˆç¡è¦ºæˆ–è§€è³æœˆäº®ã€‚"
            },
            {
                type: "mc", category: "é¸æ“‡é¡Œ", score: 5,
                text: "5. ğŸ˜ï¸ å¦‚æœä½ çœ‹åˆ°é„°å±…å¼µå¤ªå¤ªï¼Œæœ‰ç¦®è²Œçš„è¡¨ç¾æ‡‰è©²æ˜¯ï¼Ÿ",
                options: ["è£ä½œçœ‹ä¸è¦‹", "å¤§è²å°–å«", "å‘å¥¹é»é ­å¾®ç¬‘æˆ–èªªè²æ—©æ™¨", "å‘å¥¹åšé¬¼è‡‰"],
                answer: 2,
                explanation: "èˆ‡é„°å±…æ‰“æ‹›å‘¼æ˜¯ç¦é„°å‹å¥½çš„è¡¨ç¾ã€‚"
            },

            // --- å–®å…ƒäºŒï¼šæˆ‘çš„ç¤¾å€ ---
            {
                type: "mc", category: "æƒ…å¢ƒé¡Œ", score: 5,
                text: "6. ğŸ“® å¿—å¼·å¯«äº†ä¸€å°æ„Ÿè¬å¡çµ¦è€å¸«ï¼Œä»–æƒ³å¯„å‡ºå»ï¼Œä»–æ‡‰è©²å»å“ªè£¡ï¼Ÿ",
                options: ["æ¶ˆé˜²å±€", "é‹å‹•å ´", "éƒµæ”¿å±€", "è¶…ç´šå¸‚å ´"],
                answer: 2,
                explanation: "éƒµæ”¿å±€è² è²¬è™•ç†éƒµä»¶å¯„é€æœå‹™ã€‚"
            },
            {
                type: "mc", category: "é¸æ“‡é¡Œ", score: 5,
                text: "7. ğŸ“ åœ¨åœ°åœ–ä¸Šï¼Œæˆ‘å€‘ä½¿ç”¨ã€Œç¬¦è™Ÿã€çš„ä¸»è¦ç›®çš„æ˜¯ä»€éº¼ï¼Ÿ",
                options: ["è®“åœ°åœ–è‰²å½©æ›´è±å¯Œ", "ç”¨ç°¡å–®çš„åœ–æ¡ˆä»£è¡¨è¨­æ–½ä½ç½®", "ç‚ºäº†ç•«å¾—æ¯”è¼ƒæ¼‚äº®", "ç‚ºäº†å¡«æ»¿ç©ºé–“"],
                answer: 1,
                explanation: "ç¬¦è™Ÿèƒ½ç°¡æ½”æ¸…æ™°åœ°æ¨™ç¤ºè¨­æ–½ä½ç½®ï¼Œæ–¹ä¾¿é–±è®€ã€‚"
            },
            {
                type: "mc", category: "é…å°é¡Œ", score: 5,
                text: "8. ğŸ›’ åª½åª½æƒ³è²·æ–°é®®çš„è±¬è‚‰å’Œé’èœç…®æ™šé¤ï¼Œå¥¹æ‡‰è©²å»å“ªè£¡ï¼Ÿ",
                options: ["åœ–æ›¸é¤¨", "è¡—å¸‚", "å…¬åœ’", "è­¦ç½²"],
                answer: 1,
                explanation: "è¡—å¸‚æ˜¯ä¸»è¦å”®è³£æ–°é®®é£Ÿæçš„åœ°æ–¹ã€‚"
            },
            {
                type: "mc", category: "é¸æ“‡é¡Œ", score: 5,
                text: "9. ğŸ“š åœ¨åœ–æ›¸é¤¨å…§ï¼Œæˆ‘å€‘æ‡‰è©²éµå®ˆä»€éº¼è¦å‰‡ï¼Ÿ",
                options: ["ä¿æŒå®‰éœ", "å¤§è²æœ—è®€", "è¿½é€å¥”è·‘", "åƒé›¶é£Ÿ"],
                answer: 0,
                explanation: "åœ–æ›¸é¤¨æ˜¯é–±è®€çš„åœ°æ–¹ï¼Œå¿…é ˆä¿æŒå®‰éœä»¥å…æ‰“æ“¾ä»–äººã€‚"
            },

            // --- å–®å…ƒä¸‰ï¼šåˆ°éƒŠé‡å…¬åœ’å» ---
            {
                type: "mc", category: "é¸æ“‡é¡Œ", score: 5,
                text: "10. ğŸ”¢ åœ¨éƒŠé‡å…¬åœ’é è¶³æ™‚ï¼Œå“ªç¨®è¨­æ–½å¯ä»¥å‘Šè¨´æˆ‘å€‘ã€Œæ‰€è™•çš„ä½ç½®ã€ï¼Ÿ",
                options: ["æ¶¼äº­", "æ¨™è·æŸ±", "ç‡’çƒ¤çˆ", "åƒåœ¾ç®±"],
                answer: 1,
                explanation: "ã€Œæ¨™è·æŸ±ã€ä¸Šæœ‰ç·¨è™Ÿï¼Œèƒ½å¹«åŠ©è¡Œå±±äººå£«ç¢ºå®šä½ç½®ï¼Œè¿·è·¯æ™‚äº¦å¯ç”¨ä½œæ±‚æ•‘åº§æ¨™ã€‚"
            },
            {
                type: "mc", category: "é¸æ“‡é¡Œ", score: 5,
                text: "11. ğŸš® åœ¨éƒŠé‡å…¬åœ’é‡é¤å¾Œï¼Œå¦‚æœä½ ç™¼ç¾åƒåœ¾ç®±æ»¿äº†ï¼Œæ­£ç¢ºçš„åšæ³•æ˜¯ï¼Ÿ",
                options: ["æŠŠåƒåœ¾æ”¾åœ¨åƒåœ¾ç®±æ—", "æŠŠåƒåœ¾å¡é€²å»", "æŠŠåƒåœ¾å¸¶èµ° (Take your litter home)", "ä¸Ÿåœ¨è‰å¢è£¡"],
                answer: 2,
                explanation: "æ„›è­·å¤§è‡ªç„¶ï¼Œå¯¦è¡Œã€Œè‡ªå·±åƒåœ¾è‡ªå·±å¸¶èµ°ã€ã€‚"
            },
            {
                type: "mc", category: "é¸æ“‡é¡Œ", score: 5,
                text: "12. â„¹ï¸ å¦‚æœæƒ³äº†è§£éƒŠé‡å…¬åœ’å…§çš„æ¤ç‰©è³‡è¨Šæˆ–è·¯å¾‘è³‡æ–™ï¼Œæˆ‘å€‘å¯ä»¥çœ‹ä»€éº¼ï¼Ÿ",
                options: ["å‘Šç¤ºæ¿ / èªªæ˜ç‰Œ", "ç‡’çƒ¤çˆ", "è·¯ç‡ˆ", "åƒåœ¾æ¡¶"],
                answer: 0,
                explanation: "èªªæ˜ç‰Œæˆ–å‘Šç¤ºæ¿é€šå¸¸è¼‰æœ‰åœ°åœ–åŠç”Ÿæ…‹è³‡è¨Šã€‚"
            },
            {
                type: "checkbox", category: "å¤šé¸é¡Œ", score: 5,
                text: "13. ğŸ’ é è¶³æ™‚ï¼Œæˆ‘å€‘ã€Œå¿…é ˆã€å¸¶å‚™ä»¥ä¸‹å“ªäº›ç‰©å“ï¼Ÿ(å¯å¤šé¸)",
                options: ["å……è¶³çš„æ°´", "éŠæˆ²æ©Ÿ", "æ‰‹æé›»è©±", "æ²‰é‡çš„èª²æœ¬"],
                correctIndices: [0, 2],
                explanation: "æ°´è£œå……æ°´åˆ†ï¼Œé›»è©±ç”¨æ–¼è¯çµ¡æ±‚æ•‘ã€‚éŠæˆ²æ©Ÿå’Œèª²æœ¬æœƒå¢åŠ è² æ“”ä¸”ä¸å¿…è¦ã€‚"
            },
            {
                type: "mc", category: "æƒ…å¢ƒé¡Œ", score: 5,
                text: "14. ğŸŒ¸ å°æ˜çœ‹åˆ°è·¯é‚Šæœ‰ä¸€æœµå¾ˆç¾çš„èŠ±ï¼Œä»–æƒ³æ‘˜ä¸‹ä¾†ã€‚ä½ æœƒå°ä»–èªªä»€éº¼ï¼Ÿ",
                options: ["ã€Œé€™æœµèŠ±å¾ˆç¾ï¼Œå¿«æ‘˜å§ï¼ã€", "ã€Œçœ¼çœ‹æ‰‹å‹¿å‹•ï¼Œæˆ‘å€‘è¦æ„›è­·æ¤ç‰©ã€‚ã€", "ã€Œæˆ‘ä¹Ÿè¦æ‘˜ä¸€æœµã€‚ã€", "ã€Œæ²’äººçœ‹è¦‹å°±æ²’é—œä¿‚ã€‚ã€"],
                answer: 1,
                explanation: "éƒŠé‡å…¬åœ’å…§çš„ä¸€è‰ä¸€æœ¨éƒ½æ˜¯å…¬ç‰©ï¼Œä¸å¯æ¡æ‘˜ã€‚"
            },

            // --- å–®å…ƒå››ï¼šç¾éº—çš„æµ·ç˜ ---
            {
                type: "mc", category: "é¸æ“‡é¡Œ", score: 5,
                text: "15. ğŸ¦ˆ æµ·ç˜ä¸Šçš„ã€Œé˜²é¯Šç¶²ã€æœ‰ä»€éº¼ç”¨é€”ï¼Ÿ",
                options: ["ç”¨ä¾†æ•é­š", "é˜²æ­¢é¯Šé­šé€²å…¥æ³³å€ï¼Œä¿è­·æ³³å®¢", "ç”¨ä¾†æ›è¡£æœ", "è£é£¾æµ·é¢"],
                answer: 1,
                explanation: "é˜²é¯Šç¶²çš„ä½œç”¨æ˜¯é˜»éš”é¯Šé­šï¼Œä¿éšœæ³³å®¢å®‰å…¨ã€‚"
            },
            {
                type: "mc", category: "é¸æ“‡é¡Œ", score: 5,
                text: "16. ğŸš© å¦‚æœåœ¨æµ·ç˜çœ‹åˆ°æ›èµ·ã€Œç´…æ——ã€ï¼Œä»£è¡¨ä»€éº¼æ„æ€ï¼Ÿ",
                options: ["ä»Šæ—¥å¤©æ°£å¾ˆå¥½", "æµ·æµªå¤§æˆ–æœ‰å±éšªï¼Œåˆ‡å‹¿ä¸‹æ°´", "å¯ä»¥åœ¨é€™è£¡é‡é¤", "æ•‘ç”Ÿå“¡æ­£åœ¨ä¼‘æ¯"],
                answer: 1,
                explanation: "ç´…æ——æ‡¸æ›è¡¨ç¤ºè©²è™•æ¸¸æ³³æœ‰å±éšªï¼Œåš´ç¦ä¸‹æ°´ã€‚"
            },
            {
                type: "mc", category: "é¸æ“‡é¡Œ", score: 5,
                text: "17. ğŸš‘ åœ¨æµ·ç˜å—å‚·äº†ï¼Œæˆ‘å€‘æ‡‰è©²å»å“ªè£¡å°‹æ±‚å”åŠ©ï¼Ÿ",
                options: ["æ›´è¡£å®¤", "å°é£Ÿäº­", "æ•‘è­·ç«™", "æµ®å°"],
                answer: 2,
                explanation: "æ•‘è­·ç«™æœ‰æ€¥æ•‘ç”¨å“å’Œäººå“¡å¯è™•ç†å‚·å£ã€‚"
            },
            {
                type: "mc", category: "é¸æ“‡é¡Œ", score: 5,
                text: "18. ğŸŠ ä¸‹æ°´æ¸¸æ³³å‰ï¼Œç‚ºä»€éº¼è¦å…ˆåšç†±èº«é‹å‹•ï¼Ÿ",
                options: ["ç‚ºäº†å±•ç¤ºèº«æ", "ç‚ºäº†é é˜²æŠ½ç­‹", "ç‚ºäº†æ›¬é»‘çš®è†š", "ç‚ºäº†èªè­˜æœ‹å‹"],
                answer: 1,
                explanation: "ç†±èº«é‹å‹•èƒ½ä¼¸å±•è‚Œè‚‰ï¼Œæ¸›å°‘æ¸¸æ³³æ™‚æŠ½ç­‹çš„æ©Ÿæœƒã€‚"
            },
            {
                type: "mc", category: "é¸æ“‡é¡Œ", score: 5,
                text: "19. ğŸš» æ¸¸æ³³å¾Œï¼Œæ›´æ›è¡£æœæ‡‰è©²å»å“ªè£¡ï¼Ÿ",
                options: ["æ²™ç˜ä¸Š", "æ›´è¡£å®¤", "æ•‘è­·ç«™", "æµ®å°"],
                answer: 1,
                explanation: "æ›´è¡£å®¤æ˜¯æ›´æ›è¡£ç‰©çš„æŒ‡å®šå ´æ‰€ï¼Œä¿æŒè¡›ç”ŸåŠç§éš±ã€‚"
            },
            {
                type: "checkbox", category: "å¤šé¸é¡Œ", score: 5,
                text: "20. ğŸš« åœ¨æµ·ç˜ï¼Œä»¥ä¸‹å“ªäº›è¡Œç‚ºæ˜¯ã€Œä¸æ­£ç¢ºã€çš„ï¼Ÿ(é¸å‡ºæ‰€æœ‰éŒ¯èª¤è¡Œç‚º)",
                options: ["åœ¨æµ·è£¡æ¸…æ´—ç‡’çƒ¤å‰", "å¡—é˜²æ›¬ç”¨å“", "äº‚æ‹‹åƒåœ¾", "åœ¨å®‰å…¨æ³³å€æ¸¸æ³³"],
                correctIndices: [0, 2],
                explanation: "æ¸…æ´—ç‡’çƒ¤å‰æœƒæ±¡æŸ“æµ·æ°´ï¼Œäº‚æ‹‹åƒåœ¾æœƒç ´å£ç’°å¢ƒè¡›ç”Ÿã€‚"
            }
        ];

        // ç‹€æ…‹è®Šæ•¸
        let currentQuestionIndex = 0;
        let userAnswers = []; // å„²å­˜ä½¿ç”¨è€…ç­”æ¡ˆï¼š{ index: int/array, isCorrect: bool }
        let userName = "";

        // DOM Elements
        const appContainer = document.getElementById('app-container');
        const startScreen = document.getElementById('start-screen');
        const quizScreen = document.getElementById('quiz-screen');
        const resultScreen = document.getElementById('result-screen');
        const questionContainer = document.getElementById('question-container');
        const nextBtn = document.getElementById('next-btn');
        const progressBar = document.getElementById('progress-bar');

        function startQuiz() {
            const nameInput = document.getElementById('student-name');
            if (nameInput.value.trim() === "") {
                alert("è«‹è¼¸å…¥ä½ çš„åå­—å–”ï¼");
                return;
            }
            userName = nameInput.value;
            document.getElementById('display-name').innerText = userName;
            
            startScreen.classList.add('hidden');
            quizScreen.classList.remove('hidden');
            
            // é‡ç½®ç‹€æ…‹
            currentQuestionIndex = 0;
            userAnswers = new Array(questions.length).fill(null);
            updateProgress();
            showQuestion();
        }

        function updateProgress() {
            document.getElementById('current-q-num').innerText = currentQuestionIndex + 1;
            document.getElementById('total-q-num').innerText = questions.length;
            const progress = ((currentQuestionIndex) / questions.length) * 100;
            progressBar.style.width = `${progress}%`;
        }

        function showQuestion() {
            const q = questions[currentQuestionIndex];
            
            // æ›´æ–° UI
            document.getElementById('q-category').innerText = q.category;
            document.getElementById('q-text').innerText = q.text;
            
            // é‡ç½®æŒ‰éˆ•ç‹€æ…‹
            nextBtn.disabled = true;
            nextBtn.innerText = q.type === 'checkbox' ? "é¸å¥½äº†ï¼Œä¸‹ä¸€é¡Œ â¡ï¸" : "è«‹é¸æ“‡ç­”æ¡ˆ";
            nextBtn.className = "w-full bg-gray-300 text-white font-bold py-4 rounded-xl text-xl cursor-not-allowed transition";

            const optionsGrid = document.getElementById('options-grid');
            optionsGrid.innerHTML = '';

            // æ¸²æŸ“é¸é …
            if (q.type === 'mc' || q.type === 'tf' || q.type === 'é…å°é¡Œ' || q.type === 'æƒ…å¢ƒé¡Œ') {
                const opts = q.type === 'tf' ? ["æ­£ç¢º (True)", "éŒ¯èª¤ (False)"] : q.options;
                
                opts.forEach((opt, index) => {
                    const btn = document.createElement('button');
                    btn.className = 'option-btn w-full text-left p-4 rounded-xl border-2 border-orange-100 hover:bg-orange-50 text-lg font-medium text-gray-700';
                    
                    let label = "";
                    if (q.type !== 'tf') label = String.fromCharCode(65 + index) + ". ";
                    else label = (index === 0 ? "â­• " : "âŒ ");
                    
                    btn.innerHTML = `<span class="font-bold text-orange-500 mr-2">${label}</span>${opt}`;
                    
                    btn.onclick = () => selectOption(index, btn);
                    optionsGrid.appendChild(btn);
                });

            } else if (q.type === 'checkbox') {
                // å¤šé¸é¡Œé‚è¼¯
                q.options.forEach((opt, index) => {
                    const wrapper = document.createElement('div');
                    wrapper.className = "flex items-center p-4 rounded-xl border-2 border-orange-100 hover:bg-orange-50 cursor-pointer option-checkbox-wrapper";
                    wrapper.innerHTML = `
                        <input type="checkbox" id="opt-${index}" value="${index}" class="w-6 h-6 text-orange-600 rounded focus:ring-orange-500 mr-3 pointer-events-none">
                        <label class="text-lg text-gray-700 cursor-pointer flex-grow select-none">${opt}</label>
                    `;
                    wrapper.onclick = () => toggleCheckbox(index, wrapper);
                    optionsGrid.appendChild(wrapper);
                });
            }
        }

        // å–®é¸é¡Œé¸æ“‡é‚è¼¯
        function selectOption(index, btnElement) {
            // æ¸…é™¤å…¶ä»–é¸ä¸­ç‹€æ…‹
            document.querySelectorAll('.option-btn').forEach(b => b.classList.remove('selected-option'));
            // åŠ å…¥é¸ä¸­ç‹€æ…‹
            btnElement.classList.add('selected-option');
            
            // æš«å­˜ç­”æ¡ˆ
            userAnswers[currentQuestionIndex] = index;
            
            // å•Ÿç”¨ä¸‹ä¸€é¡ŒæŒ‰éˆ•
            enableNextBtn();
        }

        // å¤šé¸é¡Œé¸æ“‡é‚è¼¯
        function toggleCheckbox(index, wrapper) {
            const checkbox = wrapper.querySelector('input');
            checkbox.checked = !checkbox.checked;
            
            if(checkbox.checked) {
                wrapper.classList.add('selected-option');
            } else {
                wrapper.classList.remove('selected-option');
            }

            // æª¢æŸ¥æ˜¯å¦æœ‰é¸ä¸­è‡³å°‘ä¸€å€‹
            const anyChecked = document.querySelectorAll('input[type="checkbox"]:checked').length > 0;
            
            // æ›´æ–°æš«å­˜ç­”æ¡ˆ (å„²å­˜é¸ä¸­çš„ index é™£åˆ—)
            const checkedIndices = Array.from(document.querySelectorAll('input[type="checkbox"]:checked')).map(cb => parseInt(cb.value));
            userAnswers[currentQuestionIndex] = checkedIndices;

            if (anyChecked) enableNextBtn();
            else disableNextBtn();
        }

        function enableNextBtn() {
            nextBtn.disabled = false;
            nextBtn.innerText = currentQuestionIndex === questions.length - 1 ? "äº¤å·ï¼ŒæŸ¥çœ‹æˆç¸¾ ğŸ" : "ä¸‹ä¸€é¡Œ â¡ï¸";
            nextBtn.className = "w-full bg-orange-500 hover:bg-orange-600 text-white font-bold py-4 rounded-xl text-xl shadow-md transition transform hover:-translate-y-1";
        }

        function disableNextBtn() {
            nextBtn.disabled = true;
            nextBtn.innerText = "è«‹é¸æ“‡ç­”æ¡ˆ";
            nextBtn.className = "w-full bg-gray-300 text-white font-bold py-4 rounded-xl text-xl cursor-not-allowed transition";
        }

        function confirmAndNext() {
            // é€™è£¡å·²ç¶“åœ¨ selectOption/toggleCheckbox å„²å­˜äº† userAnswers[currentQuestionIndex]
            // ç›´æ¥é€²å…¥ä¸‹ä¸€é¡Œ
            currentQuestionIndex++;
            
            if (currentQuestionIndex < questions.length) {
                updateProgress();
                showQuestion();
                // æ²å‹•å›é ‚éƒ¨
                document.getElementById('question-container').scrollIntoView({ behavior: 'smooth' });
            } else {
                finishQuiz();
            }
        }

        function finishQuiz() {
            quizScreen.classList.add('hidden');
            resultScreen.classList.remove('hidden');
            generateReport();
        }

        function generateReport() {
            const reportContainer = document.getElementById('report-container');
            reportContainer.innerHTML = '';
            
            let totalScore = 0;
            
            questions.forEach((q, idx) => {
                const userAns = userAnswers[idx];
                let isCorrect = false;
                let userAnsText = "";
                let correctAnsText = "";

                // åˆ¤æ–·å°éŒ¯åŠæº–å‚™æ–‡å­—
                if (q.type === 'checkbox') {
                    // å¤šé¸é¡Œåˆ¤æ–·
                    const sortedUser = (userAns || []).sort().toString();
                    const sortedCorrect = q.correctIndices.sort().toString();
                    isCorrect = (sortedUser === sortedCorrect);
                    
                    userAnsText = (userAns || []).map(i => q.options[i]).join(", ") || "(æœªä½œç­”)";
                    correctAnsText = q.correctIndices.map(i => q.options[i]).join(", ");

                } else if (q.type === 'tf') {
                    // æ˜¯éé¡Œ
                    // 0=True, 1=False based on previous options map
                    // Correct answer in q.answer is boolean (true/false)
                    // Map bool to index: true->0, false->1
                    const correctIndex = q.answer ? 0 : 1;
                    isCorrect = (userAns === correctIndex);
                    
                    const tfOptions = ["æ­£ç¢º (True)", "éŒ¯èª¤ (False)"];
                    userAnsText = userAns !== null ? tfOptions[userAns] : "(æœªä½œç­”)";
                    correctAnsText = tfOptions[correctIndex];

                } else {
                    // å–®é¸
                    isCorrect = (userAns === q.answer);
                    userAnsText = userAns !== null ? (String.fromCharCode(65 + userAns) + ". " + q.options[userAns]) : "(æœªä½œç­”)";
                    correctAnsText = String.fromCharCode(65 + q.answer) + ". " + q.options[q.answer];
                }

                if (isCorrect) totalScore += q.score;

                // å»ºç«‹å ±å‘Šå¡ç‰‡ HTML
                const card = document.createElement('div');
                card.className = `bg-white p-5 rounded-xl border-l-8 shadow-sm mb-4 ${isCorrect ? 'border-green-500' : 'border-red-500'}`;
                
                card.innerHTML = `
                    <div class="flex justify-between items-start mb-2">
                        <span class="font-bold text-gray-500 text-sm">ç¬¬ ${idx + 1} é¡Œ (${q.score}åˆ†)</span>
                        <span class="text-2xl">${isCorrect ? 'âœ…' : 'âŒ'}</span>
                    </div>
                    <h3 class="font-bold text-gray-800 text-lg mb-3">${q.text}</h3>
                    
                    <div class="space-y-2 text-sm">
                        <div class="flex">
                            <span class="w-20 font-bold text-gray-500">ä½ çš„ç­”æ¡ˆï¼š</span>
                            <span class="${isCorrect ? 'text-green-600 font-bold' : 'text-red-600 font-bold'}">${userAnsText}</span>
                        </div>
                        ${!isCorrect ? `
                        <div class="flex">
                            <span class="w-20 font-bold text-gray-500">æ­£ç¢ºç­”æ¡ˆï¼š</span>
                            <span class="text-green-600 font-bold">${correctAnsText}</span>
                        </div>` : ''}
                    </div>

                    <div class="mt-4 bg-blue-50 p-3 rounded-lg text-blue-800 text-sm">
                        <strong>ğŸ’¡ è§£èªªï¼š</strong> ${q.explanation}
                    </div>
                `;
                reportContainer.appendChild(card);
            });

            // å‹•ç•«é¡¯ç¤ºåˆ†æ•¸
            const finalScoreElement = document.getElementById('final-score');
            let tempScore = 0;
            const interval = setInterval(() => {
                if (tempScore < totalScore) {
                    tempScore++;
                    finalScoreElement.innerText = tempScore;
                } else {
                    clearInterval(interval);
                }
            }, 20);
            finalScoreElement.innerText = totalScore; // ç¢ºä¿æœ€çµ‚é¡¯ç¤ºæ­£ç¢º

            // è©•èª
            const msgElem = document.getElementById('result-message');
            if (totalScore === 100) msgElem.innerText = "å¤ªå®Œç¾äº†ï¼ä½ æ˜¯å¸¸è­˜ç§‘ç‹€å…ƒï¼ğŸŒŸ";
            else if (totalScore >= 80) msgElem.innerText = "æˆç¸¾å„ªç•°ï¼ç¹¼çºŒä¿æŒï¼ğŸ‰";
            else if (totalScore >= 60) msgElem.innerText = "åŠæ ¼äº†ï¼çœ‹ä¾†æœ‰äº›åœ°æ–¹éœ€è¦å†æº«ç¿’ä¸€ä¸‹å–”ï¼ğŸ“š";
            else msgElem.innerText = "ä¸è¦æ°£é¤’ï¼çœ‹è©³ç´°å ±å‘Šæª¢è¨ä¸€ä¸‹ï¼Œä¸‹æ¬¡æœƒæ›´å¥½ï¼ğŸ’ª";

            if (totalScore === 100) createConfetti();
        }

        function restartQuiz() {
            resultScreen.classList.add('hidden');
            startScreen.classList.remove('hidden');
            document.querySelectorAll('.confetti').forEach(e => e.remove());
            document.getElementById('student-name').value = '';
        }

        function createConfetti() {
            const colors = ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00ff'];
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.animationDuration = (Math.random() * 2 + 2) + 's';
                document.body.appendChild(confetti);
            }
        }
    </script>
</body>
</html>